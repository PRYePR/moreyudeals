# Preisjaeger Phase 1 å¼€å‘å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-11
**é˜¶æ®µ**: Phase 1 - æ ¸å¿ƒåŠŸèƒ½å¼€å‘
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. Preisjaeger Normalizer âœ…
**æ–‡ä»¶**: `packages/worker/src/normalizers/preisjaeger-normalizer.ts`

**ä»£ç é‡**: ~330è¡Œ

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å®Œæ•´çš„æ•°æ®æ ‡å‡†åŒ–æµç¨‹
- âœ… æ”¯æŒåˆ—è¡¨é¡µå’Œè¯¦æƒ…é¡µä¸¤ç§æ•°æ®æº
- âœ… å®Œæ•´å­—æ®µæ˜ å°„ï¼ˆ30+ å­—æ®µï¼‰
- âœ… è‡ªåŠ¨å•†å®¶è§„èŒƒåŒ–ï¼ˆè°ƒç”¨ normalizeMerchantï¼‰
- âœ… è‡ªåŠ¨åˆ†ç±»è§„èŒƒåŒ–ï¼ˆè°ƒç”¨ normalizeCategoryï¼‰
- âœ… è‡ªåŠ¨è”ç›Ÿé“¾æ¥æ›¿æ¢ï¼ˆé›†æˆ AffiliateLinkServiceï¼‰
- âœ… æ™ºèƒ½å›¾ç‰‡ URL æ‹¼æ¥
- âœ… Unix æ—¶é—´æˆ³è‡ªåŠ¨è½¬æ¢
- âœ… æŠ˜æ‰£è‡ªåŠ¨è®¡ç®—
- âœ… æ•°æ®éªŒè¯é€»è¾‘
- âœ… é”™è¯¯å¤„ç†

**ç‰¹è‰²åŠŸèƒ½**:

1. **å›¾ç‰‡ URL è‡ªåŠ¨æ‹¼æ¥**
   ```typescript
   // è¾“å…¥: { path: "threads/raw/CjG87", name: "354419_1", ext: "jpg" }
   // è¾“å‡º: https://static.preisjaeger.at/threads/raw/CjG87/354419_1/re/768x768/qt/60/354419_1.jpg
   ```

2. **è”ç›Ÿé“¾æ¥è‡ªåŠ¨å¤„ç†**
   - Amazon é“¾æ¥è‡ªåŠ¨æ¸…æ´—
   - è‡ªåŠ¨æ›¿æ¢ä¸ºè‡ªå·±çš„è”ç›Ÿæ ‡è¯†
   - å…¶ä»–å•†å®¶ä¿ç•™åŸé“¾æ¥

3. **å¤šåˆ†ç±»æ”¯æŒ**
   - ä¼˜å…ˆä½¿ç”¨ groupsï¼ˆå¤šåˆ†ç±»ï¼‰
   - å›é€€åˆ° mainGroupï¼ˆå•åˆ†ç±»ï¼‰
   - è‡ªåŠ¨è§„èŒƒåŒ–ä¸ºç»Ÿä¸€ ID

**æ•°æ®ç±»å‹**:
```typescript
// åˆ—è¡¨é¡µæ•°æ®
interface PreisjaegerListItem {
  threadId: string;
  title: string;
  merchant?: { merchantName: string };
  mainGroup?: { threadGroupName: string };
  price?: number;
  nextBestPrice?: number;
  // ... æ›´å¤šå­—æ®µ
}

// è¯¦æƒ…é¡µæ•°æ®ï¼ˆæ‰©å±•åˆ—è¡¨é¡µï¼‰
interface PreisjaegerDetailItem extends PreisjaegerListItem {
  preparedHtmlDescription?: string;
  description?: string;
  groups?: Array<{ threadGroupName: string }>;
  cpcLink?: string;
  // ... æ›´å¤šå­—æ®µ
}
```

---

### 2. Preisjaeger Fetcher âœ…
**æ–‡ä»¶**: `packages/worker/src/fetchers/preisjaeger-fetcher.ts`

**ä»£ç é‡**: ~320è¡Œ

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… åˆ—è¡¨é¡µæŠ“å–å’Œè§£æ
- âœ… data-vue3 å±æ€§ JSON æå–
- âœ… æ™ºèƒ½å»é‡ï¼ˆæ•°æ®åº“æŸ¥è¯¢ï¼‰
- âœ… è¯¦æƒ…é¡µé™é‡æŠ“å–ï¼ˆæœ€å¤š20ä¸ªï¼‰
- âœ… éšæœºå»¶è¿Ÿï¼ˆ5-15ç§’ï¼Œå¯é…ç½®ï¼‰
- âœ… window.__INITIAL_STATE__ è§£æ
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… ç»Ÿè®¡ä¿¡æ¯è¾“å‡º

**æŠ“å–æµç¨‹**:
```
1. æŠ“å–åˆ—è¡¨é¡µ (https://www.preisjaeger.at/neu)
   â†“
2. è§£æ data-vue3 å±æ€§æå– threadId åˆ—è¡¨
   â†“
3. æ•°æ®åº“å»é‡æ£€æŸ¥ï¼ˆSELECT source_post_idï¼‰
   â†“
4. é™åˆ¶æ•°é‡ï¼ˆå–å‰ 20 ä¸ªæ–°å•†å“ï¼‰
   â†“
5. é€ä¸ªæŠ“å–è¯¦æƒ…é¡µï¼ˆå¸¦éšæœºå»¶è¿Ÿï¼‰
   â”œâ”€ æ„å»º URL: /deals/{titleSlug}-{threadId}
   â”œâ”€ æå– window.__INITIAL_STATE__.threadDetail
   â”œâ”€ è°ƒç”¨ Normalizer æ ‡å‡†åŒ–
   â”œâ”€ å»é‡æ£€æŸ¥ï¼ˆDeduplicationServiceï¼‰
   â””â”€ å…¥åº“ï¼ˆdatabase.createDealï¼‰
   â†“
6. è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
```

**é…ç½®å‚æ•°**ï¼ˆç¯å¢ƒå˜é‡ï¼‰:
```bash
PREISJAEGER_LIST_URL=https://www.preisjaeger.at/neu
PREISJAEGER_MAX_DETAIL_PAGES=20          # æ¯æ¬¡æœ€å¤šæŠ“å–20ä¸ªè¯¦æƒ…é¡µ
PREISJAEGER_DETAIL_MIN_DELAY=5000        # æœ€å°å»¶è¿Ÿ5ç§’
PREISJAEGER_DETAIL_MAX_DELAY=15000       # æœ€å¤§å»¶è¿Ÿ15ç§’
PREISJAEGER_USER_AGENT=Mozilla/5.0...    # è‡ªå®šä¹‰ User-Agent
```

**æ€§èƒ½é¢„ä¼°**:
- æ­£å¸¸æƒ…å†µï¼ˆ1-5ä¸ªæ–°å•†å“ï¼‰: < 2åˆ†é’Ÿ
- æ‰¹é‡æ›´æ–°ï¼ˆ10-20ä¸ªæ–°å•†å“ï¼‰: < 5åˆ†é’Ÿ
- åˆ—è¡¨é¡µæŠ“å–: ~1ç§’
- å•ä¸ªè¯¦æƒ…é¡µ: ~1ç§’ + 5-15ç§’å»¶è¿Ÿ

**æ—¥å¿—ç¤ºä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ å¼€å§‹æŠ“å– Preisjaeger
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æŠ“å–åˆ—è¡¨é¡µ: https://www.preisjaeger.at/neu
ğŸ“¥ åˆ—è¡¨é¡µè¿”å› 15 æ¡è®°å½•
ğŸ“Š æ–°å•†å“æ•°é‡: 5/15
ğŸ“„ [1/5] æŠ“å–è¯¦æƒ…é¡µ: tesafilm standard...
âœ… æ–°å¢: tesafilm standard...
â³ å»¶è¿Ÿ 8.3 ç§’...
ğŸ“„ [2/5] æŠ“å–è¯¦æƒ…é¡µ: ...
...
ğŸ“Š æŠ“å–ç»Ÿè®¡:
   - æŠ“å–: 5
   - æ–°å¢: 5
   - é‡å¤: 0
   - é”™è¯¯: 0
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | ä»£ç è¡Œæ•° | ä¸»è¦åŠŸèƒ½ |
|------|----------|----------|
| `preisjaeger-normalizer.ts` | ~330è¡Œ | æ•°æ®æ ‡å‡†åŒ–ã€å­—æ®µæ˜ å°„ |
| `preisjaeger-fetcher.ts` | ~320è¡Œ | åˆ—è¡¨é¡µ/è¯¦æƒ…é¡µæŠ“å– |
| **æ€»è®¡** | **~650è¡Œ** | **å®Œæ•´æŠ“å–ç³»ç»Ÿ** |

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½ JSON æå–
- åˆ—è¡¨é¡µï¼šä» `data-vue3` å±æ€§æå– JSON
- è¯¦æƒ…é¡µï¼šä» `window.__INITIAL_STATE__` æå– JSON
- æ— éœ€å¤æ‚çš„ HTML è§£æ

### 2. å®Œå–„çš„å»é‡æœºåˆ¶
- æ•°æ®åº“çº§å»é‡ï¼ˆthreadIdï¼‰
- DeduplicationService æ™ºèƒ½å»é‡
- æ”¯æŒé‡å¤è®°å½•æ›´æ–°

### 3. é¢‘ç‡æ§åˆ¶
- éšæœºå»¶è¿Ÿé¿å…æ£€æµ‹
- å¯é…ç½®çš„æŠ“å–ä¸Šé™
- é”™è¯¯é‡è¯•æœºåˆ¶

### 4. æ•°æ®è´¨é‡ä¿è¯
- å­—æ®µéªŒè¯
- ç±»å‹æ£€æŸ¥
- é”™è¯¯æ—¥å¿—

### 5. è”ç›Ÿé“¾æ¥å¤„ç†
- Amazon é“¾æ¥è‡ªåŠ¨æ¸…æ´—
- è‡ªåŠ¨æ›¿æ¢è”ç›Ÿæ ‡è¯†
- ä¿æŒå…¶ä»–å•†å®¶åŸé“¾æ¥

---

## âœ… é›†æˆå‡†å¤‡

### å·²å®Œæˆçš„å‰ç½®æ¡ä»¶

1. **é…ç½®æ–‡ä»¶** âœ…
   - `category-mapping.ts` (326è¡Œ)
   - `category-normalizer.ts` (255è¡Œ)
   - `merchant-mapping.ts` (494è¡Œï¼Œ31ä¸ªå•†å®¶)

2. **æ ¸å¿ƒä»£ç ** âœ…
   - `preisjaeger-normalizer.ts` (330è¡Œ)
   - `preisjaeger-fetcher.ts` (320è¡Œ)

3. **æ–‡æ¡£** âœ…
   - æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£
   - å­—æ®µæ˜ å°„æ–‡æ¡£
   - å¼€å‘è®¡åˆ’æ–‡æ¡£
   - ç¤ºä¾‹æ•°æ®

### å¾…å®æ–½å·¥ä½œ

1. **ç¯å¢ƒå˜é‡é…ç½®** (15åˆ†é’Ÿ)
   - æ·»åŠ  Preisjaeger é…ç½®åˆ° `.env`
   - æ›´æ–°ç¯å¢ƒå˜é‡éªŒè¯

2. **ä¸»ç¨‹åºé›†æˆ** (30åˆ†é’Ÿ)
   - å¯¼å…¥ PreisjaegerFetcher
   - æ·»åŠ åˆ°è°ƒåº¦ç³»ç»Ÿ
   - é…ç½®30åˆ†é’Ÿé—´éš”

3. **æµ‹è¯•** (1-2å°æ—¶)
   - å•å…ƒæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
   - é›†æˆæµ‹è¯•
   - æ•°æ®éªŒè¯

4. **éƒ¨ç½²** (30åˆ†é’Ÿ)
   - æ›´æ–°ç”Ÿäº§ç¯å¢ƒå˜é‡
   - éƒ¨ç½²ä»£ç 
   - ç›‘æ§é¦–æ¬¡è¿è¡Œ

---

## ğŸ“š æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶ï¼ˆ6ä¸ªï¼‰

1. âœ… `packages/worker/src/config/category-mapping.ts`
2. âœ… `packages/worker/src/utils/category-normalizer.ts`
3. âœ… `packages/worker/src/normalizers/preisjaeger-normalizer.ts`
4. âœ… `packages/worker/src/fetchers/preisjaeger-fetcher.ts`

### æ›´æ–°æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰

5. âœ… `packages/worker/src/config/merchant-mapping.ts`
   - ä¿®æ­£: amazon-at â†’ amazon-de
   - æ–°å¢: 13ä¸ªå•†å®¶

### æ–‡æ¡£æ–‡ä»¶ï¼ˆ6ä¸ªï¼‰

6. âœ… `docs/PREISJAEGER_INTEGRATION.md`
7. âœ… `docs/PREISJAEGER_CONFIG_COMPLETE.md`
8. âœ… `docs/PREISJAEGER_DEVELOPMENT_PLAN.md`
9. âœ… `docs/PREISJAEGER_TODO.md`
10. âœ… `docs/PREISJAEGER_SUMMARY.md`
11. âœ… `docs/PREISJAEGER_PHASE1_COMPLETE.md` (æœ¬æ–‡ä»¶)

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### é€‰é¡¹ A: ç«‹å³é›†æˆæµ‹è¯•
1. é…ç½®ç¯å¢ƒå˜é‡
2. é›†æˆåˆ°ä¸»ç¨‹åº
3. æœ¬åœ°æµ‹è¯•è¿è¡Œ
4. éªŒè¯æ•°æ®å…¥åº“

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

### é€‰é¡¹ B: å…ˆå†™å•å…ƒæµ‹è¯•
1. ç¼–å†™ Normalizer æµ‹è¯•
2. ç¼–å†™ Fetcher æµ‹è¯•ï¼ˆmockï¼‰
3. éªŒè¯æ ¸å¿ƒé€»è¾‘
4. å†è¿›è¡Œé›†æˆ

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

### é€‰é¡¹ C: ç›´æ¥ç”Ÿäº§éƒ¨ç½²
1. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
2. éƒ¨ç½²ä»£ç 
3. å¯åŠ¨æŠ“å–
4. ç›‘æ§è¿è¡Œ

**é¢„è®¡æ—¶é—´**: 1å°æ—¶

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é¦–æ¬¡è¿è¡Œ
- å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œ
- éªŒè¯æ•°æ®æ­£ç¡®æ€§
- æ£€æŸ¥å›¾ç‰‡ URL æ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤è”ç›Ÿé“¾æ¥æ˜¯å¦æ­£ç¡®

### 2. ç›‘æ§è¦ç‚¹
- æŠ“å–æˆåŠŸç‡
- æœªåŒ¹é…å•†å®¶/åˆ†ç±»
- å›¾ç‰‡åŠ è½½æ˜¯å¦æ­£å¸¸
- è”ç›Ÿé“¾æ¥æ›¿æ¢ç‡

### 3. æ½œåœ¨é—®é¢˜
- Cloudflare é™åˆ¶ï¼ˆå¯èƒ½éœ€è¦ Cookieï¼‰
- é¢‘ç‡é™åˆ¶ï¼ˆå·²æœ‰5-15ç§’å»¶è¿Ÿï¼‰
- æ•°æ®æ ¼å¼å˜åŒ–ï¼ˆç›‘æ§è§£æé”™è¯¯ï¼‰

---

**Phase 1 å®Œæˆæ—¶é—´**: 2025-11-11
**å¼€å‘è€—æ—¶**: ~2å°æ—¶
**ä»£ç æ€»é‡**: ~650è¡Œ + é…ç½®æ–‡ä»¶
**å‡†å¤‡çŠ¶æ€**: âœ… å¯ä»¥å¼€å§‹é›†æˆæµ‹è¯•
