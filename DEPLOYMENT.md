# Moreyudeals Ubuntu æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: v2.0 (åŸºäº T10 éªŒè¯)
**æ›´æ–°æ—¥æœŸ**: 2025-11-02
**é€‚ç”¨ç¯å¢ƒ**: Ubuntu 20.04+ / Debian 11+
**æœåŠ¡å™¨**: è…¾è®¯äº‘è½»é‡æœåŠ¡å™¨ 43.157.40.96

---

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
2. [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
3. [å¿«é€Ÿéƒ¨ç½²](#å¿«é€Ÿéƒ¨ç½²)
4. [è¯¦ç»†éƒ¨ç½²æ­¥éª¤](#è¯¦ç»†éƒ¨ç½²æ­¥éª¤)
5. [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
6. [è¿ç»´ç®¡ç†](#è¿ç»´ç®¡ç†)
7. [ç›‘æ§å’Œç»´æŠ¤](#ç›‘æ§å’Œç»´æŠ¤)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
9. [å®‰å…¨åŠ å›º](#å®‰å…¨åŠ å›º)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      è…¾è®¯äº‘æœåŠ¡å™¨ (43.157.40.96)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL 15.5 (æœ¬åœ°)                      â”‚
â”‚  â”œâ”€ moreyudeals æ•°æ®åº“                       â”‚
â”‚  â””â”€ 128 æ¡ä¼˜æƒ æ•°æ® (å·²éªŒè¯)                  â”‚
â”‚                                              â”‚
â”‚  Worker æœåŠ¡ (PM2ç®¡ç†)                       â”‚
â”‚  â”œâ”€ æŠ“å–æ¨¡å—: Sparhamster RSS               â”‚
â”‚  â”œâ”€ å»é‡æ¨¡å—: åŸºäºGUIDå’Œå†…å®¹å“ˆå¸Œ             â”‚
â”‚  â”œâ”€ ç¿»è¯‘æ¨¡å—: DeepL (å¯é€‰å¯ç”¨)               â”‚
â”‚  â””â”€ è°ƒåº¦å™¨: 30åˆ†é’Ÿé—´éš” + éšæœºå»¶è¿Ÿ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ æ•°æ®è¾“å‡º (è®¡åˆ’ä¸­)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Vercel (Webå‰ç«¯)                    â”‚
â”‚  Next.js + PostgreSQLç›´è¿                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Ubuntu | 20.04+ | æ“ä½œç³»ç»Ÿ |
| Node.js | 18+ | è¿è¡Œç¯å¢ƒ |
| PostgreSQL | 15.5 | æ•°æ®åº“ |
| PM2 | 5.x | è¿›ç¨‹ç®¡ç† |
| Git | 2.x | ä»£ç ç®¡ç† |

### å·²éªŒè¯åŠŸèƒ½ (T10æµ‹è¯•)

âœ… **æŠ“å–æ¨¡å—**
- APIæŠ“å–: 40æ¡/æ¬¡
- HTMLæŠ“å–: 3é¡µ
- å•†å®¶è¯†åˆ«: 75% æˆåŠŸç‡
- å»é‡: 100% å‡†ç¡®ç‡

âœ… **ç¿»è¯‘æ¨¡å—**
- DeepLç¿»è¯‘: 6/6 æˆåŠŸ
- å¹³å‡è€—æ—¶: æ ‡é¢˜ 250ms, HTML 950ms
- ç¿»è¯‘è´¨é‡: è‰¯å¥½

âœ… **æ•°æ®åº“**
- æ€»è®°å½•: 128æ¡
- å·²ç¿»è¯‘: 127æ¡
- æ— æ•°æ®æŸå

---

## å‰ç½®å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚

| é¡¹ç›® | æœ€å°é…ç½® | æ¨èé…ç½® |
|------|---------|---------|
| CPU | 1æ ¸ | 2æ ¸+ |
| å†…å­˜ | 2GB | 4GB+ |
| ç¡¬ç›˜ | 20GB | 40GB+ |
| å¸¦å®½ | 1Mbps | 3Mbps+ |

### 2. åŸŸåå’ŒDNS (å¯é€‰)

å¦‚æœéœ€è¦å¯¹å¤–æä¾›APIæœåŠ¡:
- åŸŸå: `api.moreyu.com` (ç¤ºä¾‹)
- SSLè¯ä¹¦: Let's Encrypt

### 3. è´¦å·å‡†å¤‡

- æœåŠ¡å™¨ root æˆ– sudo æƒé™
- GitHub è´¦å· (ç”¨äºå…‹éš†ä»£ç )
- DeepL API Key (å¦‚éœ€ç¿»è¯‘åŠŸèƒ½)

### 4. å®‰å…¨ç»„é…ç½®

åœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°æ‰“å¼€ä»¥ä¸‹ç«¯å£:

| ç«¯å£ | åè®® | ç”¨é€” | å…è®¸æ¥æº |
|------|------|------|---------|
| 22 | TCP | SSH | ä½ çš„IP |
| 5432 | TCP | PostgreSQL | 127.0.0.1 (ä»…æœ¬åœ°) |
| 80 | TCP | HTTP (å¯é€‰) | 0.0.0.0/0 |
| 443 | TCP | HTTPS (å¯é€‰) | 0.0.0.0/0 |

---

## å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½² (æ¨è)

```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh root@43.157.40.96

# 2. å…‹éš†ä»£ç 
git clone https://github.com/PRYePR/moreyudeals.git /www/wwwroot/Moreyudeals
cd /www/wwwroot/Moreyudeals

# 3. æˆäºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/*.sh

# 4. åˆå§‹åŒ–æ•°æ®åº“
sudo bash scripts/init-database-server.sh

# 5. ä¸€é”®éƒ¨ç½²
bash scripts/deploy-server.sh

# 6. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
pm2 logs moreyudeals-worker --lines 50
```

### éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€ (åº”è¯¥æ˜¾ç¤º online)
pm2 list

# æŸ¥çœ‹æœ€æ–°æ•°æ®
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "SELECT COUNT(*) FROM deals WHERE created_at > NOW() - INTERVAL '1 hour';"

# æŸ¥çœ‹æ—¥å¿—
tail -f ~/.pm2/logs/moreyudeals-worker-out.log
```

---

## è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: ç¯å¢ƒå®‰è£…

#### 1.1 æ›´æ–°ç³»ç»Ÿ

```bash
sudo apt update && sudo apt upgrade -y
```

#### 1.2 å®‰è£… Node.js 18

```bash
# æ·»åŠ  NodeSource ä»“åº“
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -

# å®‰è£… Node.js
sudo apt install -y nodejs

# éªŒè¯
node --version  # åº”è¯¥æ˜¾ç¤º v18.x.x
npm --version   # åº”è¯¥æ˜¾ç¤º 9.x.x
```

#### 1.3 å®‰è£… PM2

```bash
# å…¨å±€å®‰è£…
sudo npm install -g pm2

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# æ‰§è¡Œè¾“å‡ºçš„å‘½ä»¤ (é€šå¸¸æ˜¯ sudo env PATH=...)

# éªŒè¯
pm2 --version
```

#### 1.4 å®‰è£… PostgreSQL 15

```bash
# æ·»åŠ  PostgreSQL å®˜æ–¹ä»“åº“
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

# å®‰è£… PostgreSQL 15
sudo apt update
sudo apt install -y postgresql-15 postgresql-client-15

# å¯åŠ¨å¹¶å¯ç”¨
sudo systemctl start postgresql
sudo systemctl enable postgresql

# éªŒè¯
sudo -u postgres psql -c "SELECT version();"
```

#### 1.5 å®‰è£… Git

```bash
sudo apt install -y git

# é…ç½® (å¯é€‰)
git config --global user.name "Your Name"
git config --global user.email "your@email.com"
```

#### 1.6 å®‰è£…å…¶ä»–å·¥å…·

```bash
# å®‰è£…å¿…è¦å·¥å…·
sudo apt install -y curl wget vim htop

# å®‰è£…æ„å»ºå·¥å…· (å¯é€‰ï¼ŒæŸäº›npmåŒ…éœ€è¦)
sudo apt install -y build-essential
```

### æ­¥éª¤ 2: æ•°æ®åº“åˆå§‹åŒ–

#### 2.1 é…ç½® PostgreSQL

```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -i -u postgres

# è¿›å…¥ psql
psql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE moreyudeals;
CREATE USER moreyudeals WITH PASSWORD '338e930fbb';
GRANT ALL PRIVILEGES ON DATABASE moreyudeals TO moreyudeals;

# æˆäºˆpublic schemaæƒé™
\c moreyudeals
GRANT ALL PRIVILEGES ON SCHEMA public TO moreyudeals;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO moreyudeals;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO moreyudeals;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO moreyudeals;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO moreyudeals;

# é€€å‡º
\q
exit
```

#### 2.2 è¿è¡Œè¿ç§»è„šæœ¬

```bash
cd /www/wwwroot/Moreyudeals
sudo bash scripts/init-database-server.sh
```

**é¢„æœŸè¾“å‡º**:
```
âœ“ æƒé™æ£€æŸ¥é€šè¿‡
âœ“ æ•°æ®åº“å·²å°±ç»ª
âœ“ ç”¨æˆ·é…ç½®å®Œæˆ
âœ“ æƒé™æˆäºˆå®Œæˆ
âœ“ 001_initial_schema.sql å®Œæˆ
âœ“ 002_add_indexes.sql å®Œæˆ
...
âœ“ æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
```

#### 2.3 éªŒè¯è¡¨ç»“æ„

```bash
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals -c "\dt"
```

åº”è¯¥çœ‹åˆ°ä»¥ä¸‹è¡¨:
- `deals` - ä¼˜æƒ ä¸»è¡¨
- `data_sources` - æ•°æ®æºé…ç½®

### æ­¥éª¤ 3: å…‹éš†ä»£ç 

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p /www/wwwroot
cd /www/wwwroot

# å…‹éš†ä»“åº“
sudo git clone https://github.com/PRYePR/moreyudeals.git Moreyudeals

# è®¾ç½®æƒé™
sudo chown -R $USER:$USER Moreyudeals

# è¿›å…¥é¡¹ç›®
cd Moreyudeals

# åˆ‡æ¢åˆ°æœ€æ–°åˆ†æ”¯
git checkout latest-2025
```

### æ­¥éª¤ 4: å®‰è£…ä¾èµ–

```bash
cd /www/wwwroot/Moreyudeals

# å®‰è£…æ ¹ç›®å½•ä¾èµ– (å¦‚æœæ˜¯monorepo)
npm install

# å®‰è£…Workerä¾èµ–
cd packages/worker
npm install

# éªŒè¯ä¾èµ–
npm list --depth=0
```

### æ­¥éª¤ 5: åˆ›å»ºé…ç½®æ–‡ä»¶

åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®:

```bash
cd /www/wwwroot/Moreyudeals/packages/worker
nano .env.production
```

**åŸºç¡€é…ç½®** (æœ€å°åŒ–):
```env
# === æ•°æ®åº“é…ç½® ===
DB_HOST=localhost
DB_PORT=5432
DB_NAME=moreyudeals
DB_USER=moreyudeals
DB_PASSWORD=338e930fbb

# === Sparhamster API é…ç½® ===
SPARHAMSTER_API_URL=https://www.sparhamster.at/wp-json/wp/v2/posts
SPARHAMSTER_API_LIMIT=40
SPARHAMSTER_BASE_URL=https://www.sparhamster.at
SPARHAMSTER_TOKEN=0ccb1264cd81ad8e20f27dd146dfa37d
SPARHAMSTER_USER_AGENT=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

# === æŠ“å–é…ç½® ===
FETCH_INTERVAL=30
FETCH_RANDOM_DELAY_MIN=0
FETCH_RANDOM_DELAY_MAX=5

# === ç¿»è¯‘é…ç½® (é»˜è®¤å…³é—­) ===
TRANSLATION_ENABLED=false
TRANSLATION_BATCH_SIZE=10
TRANSLATION_TARGET_LANGUAGES=zh,en

# === DeepL API é…ç½® (å¦‚éœ€ç¿»è¯‘) ===
# DEEPL_API_KEY=your_key_here
# DEEPL_ENDPOINT=https://api-free.deepl.com/v2

# === æ—¥å¿—é…ç½® ===
LOG_LEVEL=info
NODE_ENV=production
```

ä¿å­˜å¹¶é€€å‡º (Ctrl+O, Enter, Ctrl+X)

### æ­¥éª¤ 6: æ„å»ºé¡¹ç›®

```bash
cd /www/wwwroot/Moreyudeals/packages/worker

# ç¼–è¯‘ TypeScript
npm run build

# éªŒè¯æ„å»º
ls -la dist/
```

åº”è¯¥çœ‹åˆ° `dist/index.js` ç­‰æ–‡ä»¶

### æ­¥éª¤ 7: åˆ›å»ºæ—¥å¿—ç›®å½•

```bash
cd /www/wwwroot/Moreyudeals/packages/worker
mkdir -p logs
```

### æ­¥éª¤ 8: å¯åŠ¨æœåŠ¡

```bash
cd /www/wwwroot/Moreyudeals/packages/worker

# ä½¿ç”¨ PM2 å¯åŠ¨
pm2 start ecosystem.config.js --env production

# ä¿å­˜ PM2 é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# æ‰§è¡Œè¾“å‡ºçš„ sudo å‘½ä»¤

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs moreyudeals-worker --lines 50
```

### æ­¥éª¤ 9: éªŒè¯éƒ¨ç½²

#### 9.1 æ£€æŸ¥è¿›ç¨‹çŠ¶æ€

```bash
pm2 list
```

**é¢„æœŸè¾“å‡º**:
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name                   â”‚ mode    â”‚ status  â”‚ restart â”‚ uptime   â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ moreyudeals-worker     â”‚ fork    â”‚ online  â”‚ 0       â”‚ 5s       â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 9.2 æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
pm2 logs moreyudeals-worker -f
```

**åº”è¯¥çœ‹åˆ°**:
```
ğŸš€ å¯åŠ¨ Moreyudeals Worker æœåŠ¡
ğŸ“¦ é…ç½®ä¿¡æ¯:
  - æ•°æ®åº“: localhost:5432/moreyudeals
  - æŠ“å–é—´éš”: 30 åˆ†é’Ÿ
  - ç¿»è¯‘: ç¦ç”¨
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ”„ æ‰§è¡Œé¦–æ¬¡æŠ“å–...
ğŸ“Š æŠ“å–ä»»åŠ¡å®Œæˆ:
  - è·å–è®°å½•: 40
  - æ–°å¢è®°å½•: 6
  - é‡å¤è®°å½•: 34
```

#### 9.3 æ£€æŸ¥æ•°æ®åº“æ•°æ®

```bash
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "SELECT COUNT(*) as total,
             COUNT(CASE WHEN created_at > NOW() - INTERVAL '10 minutes' THEN 1 END) as recent
      FROM deals;"
```

#### 9.4 éªŒè¯å•†å®¶æå–

```bash
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "SELECT
        LEFT(title, 40) as title,
        merchant,
        LEFT(merchant_link, 50) as link
      FROM deals
      WHERE created_at > NOW() - INTERVAL '10 minutes'
      LIMIT 5;"
```

**éªŒè¯ç‚¹**:
- âœ… merchant åº”è¯¥æ˜¯çœŸå®å•†å®¶ (ä¸æ˜¯ "sparhamster")
- âœ… merchant_link åº”è¯¥åŒ…å« "forward.sparhamster.at"
- âœ… æœ‰æ–°å¢æ•°æ®

---

## é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡è¯´æ˜

#### å¿…éœ€é…ç½®

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `DB_HOST` | æ•°æ®åº“ä¸»æœº | localhost |
| `DB_PORT` | æ•°æ®åº“ç«¯å£ | 5432 |
| `DB_NAME` | æ•°æ®åº“åç§° | moreyudeals |
| `DB_USER` | æ•°æ®åº“ç”¨æˆ· | moreyudeals |
| `DB_PASSWORD` | æ•°æ®åº“å¯†ç  | ä½ çš„å¯†ç  |
| `SPARHAMSTER_API_URL` | APIåœ°å€ | https://www.sparhamster.at/wp-json/wp/v2/posts |
| `SPARHAMSTER_BASE_URL` | ç½‘ç«™åœ°å€ | https://www.sparhamster.at |

#### å¯é€‰é…ç½®

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `FETCH_INTERVAL` | æŠ“å–é—´éš”(åˆ†é’Ÿ) | 30 |
| `FETCH_RANDOM_DELAY_MIN` | éšæœºå»¶è¿Ÿæœ€å°å€¼(åˆ†é’Ÿ) | 0 |
| `FETCH_RANDOM_DELAY_MAX` | éšæœºå»¶è¿Ÿæœ€å¤§å€¼(åˆ†é’Ÿ) | 5 |
| `TRANSLATION_ENABLED` | å¯ç”¨ç¿»è¯‘ | false |
| `TRANSLATION_BATCH_SIZE` | ç¿»è¯‘æ‰¹æ¬¡å¤§å° | 10 |
| `DEEPL_API_KEY` | DeepL APIå¯†é’¥ | - |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | info |

### ecosystem.config.js è¯´æ˜

PM2é…ç½®æ–‡ä»¶ä½ç½®: `/www/wwwroot/Moreyudeals/packages/worker/ecosystem.config.js`

```javascript
module.exports = {
  apps: [{
    name: 'moreyudeals-worker',      // åº”ç”¨åç§°
    script: 'dist/index.js',          // å¯åŠ¨è„šæœ¬
    instances: 1,                     // å®ä¾‹æ•°é‡
    exec_mode: 'fork',                // æ‰§è¡Œæ¨¡å¼
    autorestart: true,                // è‡ªåŠ¨é‡å¯
    watch: false,                     // ä¸ç›‘æ§æ–‡ä»¶å˜åŒ–
    max_memory_restart: '1G',         // å†…å­˜é™åˆ¶
    env: {
      NODE_ENV: 'production',
      // ... ç¯å¢ƒå˜é‡
    },
    error_file: 'logs/error.log',    // é”™è¯¯æ—¥å¿—
    out_file: 'logs/out.log',        // è¾“å‡ºæ—¥å¿—
    merge_logs: true,                 // åˆå¹¶æ—¥å¿—
    time: true                        // æ—¥å¿—æ—¶é—´æˆ³
  }]
};
```

### å¯ç”¨ç¿»è¯‘åŠŸèƒ½

å¦‚æœéœ€è¦å¯ç”¨ç¿»è¯‘:

```bash
# ç¼–è¾‘é…ç½®
nano /www/wwwroot/Moreyudeals/packages/worker/.env.production
```

ä¿®æ”¹ä»¥ä¸‹é…ç½®:
```env
TRANSLATION_ENABLED=true
DEEPL_API_KEY=1f7dff02-4dff-405f-94db-0d1ee398130f:fx
DEEPL_ENDPOINT=https://api-free.deepl.com/v2
```

é‡å¯æœåŠ¡:
```bash
pm2 restart moreyudeals-worker
```

---

## è¿ç»´ç®¡ç†

### PM2 å¸¸ç”¨å‘½ä»¤

```bash
# === æŸ¥çœ‹çŠ¶æ€ ===
pm2 list                              # åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹
pm2 status                            # åŒä¸Š
pm2 show moreyudeals-worker           # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 monit                             # å®æ—¶ç›‘æ§

# === æ—¥å¿—ç®¡ç† ===
pm2 logs moreyudeals-worker           # æŸ¥çœ‹æ—¥å¿—
pm2 logs moreyudeals-worker -f        # å®æ—¶æ—¥å¿—
pm2 logs moreyudeals-worker --lines 100  # æœ€è¿‘100è¡Œ
pm2 logs moreyudeals-worker --err     # ä»…é”™è¯¯æ—¥å¿—
pm2 flush                             # æ¸…ç©ºæ—¥å¿—

# === è¿›ç¨‹ç®¡ç† ===
pm2 restart moreyudeals-worker        # é‡å¯
pm2 reload moreyudeals-worker         # å¹³æ»‘é‡å¯
pm2 stop moreyudeals-worker           # åœæ­¢
pm2 start moreyudeals-worker          # å¯åŠ¨
pm2 delete moreyudeals-worker         # åˆ é™¤

# === é…ç½®ç®¡ç† ===
pm2 save                              # ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 resurrect                         # æ¢å¤è¿›ç¨‹åˆ—è¡¨
pm2 startup                           # ç”Ÿæˆå¼€æœºå¯åŠ¨è„šæœ¬
pm2 unstartup                         # ç¦ç”¨å¼€æœºå¯åŠ¨
```

### ä»£ç æ›´æ–°æµç¨‹

#### æ–¹æ³• 1: ä½¿ç”¨è‡ªåŠ¨è„šæœ¬ (æ¨è)

```bash
cd /www/wwwroot/Moreyudeals
bash scripts/update-server.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨:
1. æ‹‰å–æœ€æ–°ä»£ç 
2. å®‰è£…æ–°ä¾èµ–
3. é‡æ–°æ„å»º
4. é‡å¯æœåŠ¡

#### æ–¹æ³• 2: æ‰‹åŠ¨æ›´æ–°

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/Moreyudeals

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin latest-2025

# 3. å®‰è£…ä¾èµ– (å¦‚æœ‰å˜åŒ–)
cd packages/worker
npm install

# 4. é‡æ–°æ„å»º
npm run build

# 5. é‡å¯æœåŠ¡
pm2 restart moreyudeals-worker

# 6. æŸ¥çœ‹æ—¥å¿—
pm2 logs moreyudeals-worker --lines 50
```

### æ•°æ®åº“ç®¡ç†

#### è¿æ¥æ•°æ®åº“

```bash
# æœ¬åœ°è¿æ¥
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals

# æˆ–ä½¿ç”¨sudo
sudo -u postgres psql -d moreyudeals
```

#### å¸¸ç”¨SQLå‘½ä»¤

```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

-- æŸ¥çœ‹è¡¨ç»“æ„
\d deals

-- æŸ¥çœ‹è®°å½•æ•°
SELECT COUNT(*) FROM deals;

-- æŸ¥çœ‹æœ€æ–°è®°å½•
SELECT id, LEFT(title, 50) as title, merchant, created_at
FROM deals
ORDER BY created_at DESC
LIMIT 10;

-- æŸ¥çœ‹ç¿»è¯‘çŠ¶æ€åˆ†å¸ƒ
SELECT translation_status, COUNT(*) as count
FROM deals
GROUP BY translation_status;

-- æŸ¥çœ‹å•†å®¶åˆ†å¸ƒ
SELECT merchant, COUNT(*) as count
FROM deals
WHERE merchant IS NOT NULL
GROUP BY merchant
ORDER BY count DESC
LIMIT 20;

-- åˆ é™¤æ—§æ•°æ® (30å¤©å‰)
DELETE FROM deals WHERE created_at < NOW() - INTERVAL '30 days';

-- æ¸…ç©ºè¡¨ (æ…ç”¨!)
TRUNCATE TABLE deals;
```

#### æ•°æ®åº“å¤‡ä»½

**åˆ›å»ºå¤‡ä»½è„šæœ¬**:

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
sudo mkdir -p /backups/moreyudeals
sudo chown $USER:$USER /backups/moreyudeals

# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /backups/backup-db.sh <<'EOF'
#!/bin/bash
BACKUP_DIR="/backups/moreyudeals"
DATE=$(date +%Y%m%d_%H%M%S)
FILENAME="moreyudeals_${DATE}.sql.gz"

# å¤‡ä»½æ•°æ®åº“
PGPASSWORD=338e930fbb pg_dump \
  -h localhost \
  -p 5432 \
  -U moreyudeals \
  moreyudeals \
  | gzip > "${BACKUP_DIR}/${FILENAME}"

# ä¿ç•™æœ€è¿‘7å¤©
find ${BACKUP_DIR} -name "*.sql.gz" -mtime +7 -delete

echo "âœ“ å¤‡ä»½å®Œæˆ: ${FILENAME}"
EOF

chmod +x /backups/backup-db.sh
```

**è®¾ç½®å®šæ—¶å¤‡ä»½**:

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ : æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /backups/backup-db.sh >> /backups/backup.log 2>&1
```

**æ‰‹åŠ¨å¤‡ä»½**:

```bash
# ç«‹å³æ‰§è¡Œå¤‡ä»½
/backups/backup-db.sh

# æˆ–æ‰‹åŠ¨å¤‡ä»½
PGPASSWORD=338e930fbb pg_dump \
  -h localhost \
  -p 5432 \
  -U moreyudeals \
  moreyudeals \
  > moreyudeals_$(date +%Y%m%d).sql
```

**æ¢å¤å¤‡ä»½**:

```bash
# è§£å‹å¹¶æ¢å¤
gunzip -c /backups/moreyudeals/moreyudeals_20251102_020000.sql.gz | \
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals
```

---

## ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# å®æ—¶ç›‘æ§
htop

# å†…å­˜ä½¿ç”¨
free -h

# ç£ç›˜ä½¿ç”¨
df -h

# PM2 ç›‘æ§
pm2 monit

# æŸ¥çœ‹è¿›ç¨‹èµ„æº
pm2 status
```

### æ—¥å¿—ç®¡ç†

**æ—¥å¿—ä½ç½®**:
- PM2æ—¥å¿—: `~/.pm2/logs/`
- Workeræ—¥å¿—: `/www/wwwroot/Moreyudeals/packages/worker/logs/`
- PostgreSQLæ—¥å¿—: `/var/log/postgresql/`

**æŸ¥çœ‹æ—¥å¿—**:

```bash
# PM2æ—¥å¿—
pm2 logs moreyudeals-worker --lines 100

# Workerè‡ªå®šä¹‰æ—¥å¿—
tail -f /www/wwwroot/Moreyudeals/packages/worker/logs/out.log

# PostgreSQLæ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-15-main.log
```

**æ—¥å¿—è½®è½¬**:

```bash
# å®‰è£…PM2æ—¥å¿—è½®è½¬æ¨¡å—
pm2 install pm2-logrotate

# é…ç½®
pm2 set pm2-logrotate:max_size 100M     # å•ä¸ªæ–‡ä»¶æœ€å¤§100MB
pm2 set pm2-logrotate:retain 7          # ä¿ç•™7ä¸ªæ–‡ä»¶
pm2 set pm2-logrotate:compress true     # å‹ç¼©æ—§æ—¥å¿—
```

### å¥åº·æ£€æŸ¥è„šæœ¬

åˆ›å»º `/root/health-check.sh`:

```bash
#!/bin/bash

# æ£€æŸ¥WorkeræœåŠ¡çŠ¶æ€
STATUS=$(pm2 jlist | jq -r '.[] | select(.name=="moreyudeals-worker") | .pm2_env.status' 2>/dev/null)

if [ "$STATUS" != "online" ]; then
    echo "[$(date)] âš ï¸ WorkeræœåŠ¡å¼‚å¸¸: $STATUS"
    pm2 restart moreyudeals-worker
    echo "[$(date)] å·²å°è¯•é‡å¯æœåŠ¡"
fi

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
DB_CHECK=$(PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals -tAc "SELECT 1;" 2>/dev/null)

if [ "$DB_CHECK" != "1" ]; then
    echo "[$(date)] âš ï¸ æ•°æ®åº“è¿æ¥å¤±è´¥"
fi

# æ£€æŸ¥æœ€è¿‘1å°æ—¶æ˜¯å¦æœ‰æ–°æ•°æ®
RECENT_COUNT=$(PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals -tAc "SELECT COUNT(*) FROM deals WHERE created_at > NOW() - INTERVAL '1 hour';" 2>/dev/null)

if [ "$RECENT_COUNT" -eq 0 ]; then
    echo "[$(date)] âš ï¸ è¿‡å»1å°æ—¶æ— æ–°æ•°æ®"
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ "$DISK_USAGE" -gt 80 ]; then
    echo "[$(date)] âš ï¸ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${DISK_USAGE}%"
fi
```

è®¾ç½®å®šæ—¶æ£€æŸ¥:
```bash
chmod +x /root/health-check.sh
crontab -e

# æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
0 * * * * /root/health-check.sh >> /var/log/health-check.log 2>&1
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Workeræ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: `pm2 list` æ˜¾ç¤º `errored` æˆ– `stopped`

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs moreyudeals-worker --err --lines 50

# 2. æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
ls -la /www/wwwroot/Moreyudeals/packages/worker/dist/

# 3. æ‰‹åŠ¨è¿è¡Œçœ‹è¯¦ç»†é”™è¯¯
cd /www/wwwroot/Moreyudeals/packages/worker
node dist/index.js

# 4. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat ecosystem.config.js
```

**å¸¸è§åŸå› **:
- æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥æ•°æ®åº“å¯†ç å’Œç½‘ç»œ
- ä¾èµ–ç¼ºå¤± â†’ è¿è¡Œ `npm install`
- æ„å»ºå¤±è´¥ â†’ è¿è¡Œ `npm run build`
- ç«¯å£å ç”¨ â†’ æ£€æŸ¥å…¶ä»–è¿›ç¨‹

### é—®é¢˜ 2: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º "ECONNREFUSED" æˆ– "authentication failed"

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
sudo systemctl status postgresql

# 2. å¯åŠ¨PostgreSQL
sudo systemctl start postgresql

# 3. æµ‹è¯•è¿æ¥
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals -c "SELECT 1;"

# 4. æ£€æŸ¥pg_hba.conf
sudo cat /etc/postgresql/15/main/pg_hba.conf | grep moreyudeals

# 5. æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®
sudo -u postgres psql -c "\du moreyudeals"

# 6. é‡ç½®å¯†ç  (å¦‚éœ€è¦)
sudo -u postgres psql -c "ALTER USER moreyudeals WITH PASSWORD '338e930fbb';"
```

### é—®é¢˜ 3: æ— æ–°æ•°æ®æŠ“å–

**ç—‡çŠ¶**: æ•°æ®åº“é•¿æ—¶é—´æ— æ–°è®°å½•

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æŸ¥çœ‹æ—¥å¿—
pm2 logs moreyudeals-worker | grep "æŠ“å–"

# 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://www.sparhamster.at

# 3. æ‰‹åŠ¨æµ‹è¯•æŠ“å–
cd /www/wwwroot/Moreyudeals/packages/worker
TRANSLATION_ENABLED=false npx tsx src/index.ts

# 4. æ£€æŸ¥æ•°æ®æºé…ç½®
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "SELECT * FROM data_sources;"

# 5. æŸ¥çœ‹æœ€è¿‘é”™è¯¯
pm2 logs moreyudeals-worker --err --lines 100
```

### é—®é¢˜ 4: å†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶**: PM2æ˜¾ç¤ºå†…å­˜è¶…è¿‡1GB

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æŸ¥çœ‹å†…å­˜ä½¿ç”¨
pm2 status
free -h

# 2. é‡å¯æœåŠ¡
pm2 restart moreyudeals-worker

# 3. è°ƒæ•´å†…å­˜é™åˆ¶
# ç¼–è¾‘ ecosystem.config.js
nano /www/wwwroot/Moreyudeals/packages/worker/ecosystem.config.js

# ä¿®æ”¹: max_memory_restart: '500M'

# 4. é‡æ–°å¯åŠ¨
pm2 delete moreyudeals-worker
pm2 start ecosystem.config.js --env production
pm2 save
```

### é—®é¢˜ 5: ç¿»è¯‘å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤ºç¿»è¯‘é”™è¯¯ï¼Œtranslation_status ä¸º failed

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥DeepL API Keyæ˜¯å¦æœ‰æ•ˆ
curl -X POST "https://api-free.deepl.com/v2/translate" \
  -d "auth_key=YOUR_API_KEY" \
  -d "text=Hello" \
  -d "target_lang=ZH"

# 2. æ£€æŸ¥é…ç½®
cat /www/wwwroot/Moreyudeals/packages/worker/.env.production | grep DEEPL

# 3. æŸ¥çœ‹ç¿»è¯‘é”™è¯¯æ—¥å¿—
pm2 logs moreyudeals-worker | grep "ç¿»è¯‘"

# 4. é‡è¯•å¤±è´¥çš„ç¿»è¯‘
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "UPDATE deals SET translation_status = 'pending' WHERE translation_status = 'failed';"

# 5. é‡å¯æœåŠ¡
pm2 restart moreyudeals-worker
```

### é—®é¢˜ 6: ç£ç›˜ç©ºé—´ä¸è¶³

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º "ENOSPC" æˆ–ç£ç›˜ä½¿ç”¨ç‡ > 90%

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h
du -sh /www/wwwroot/Moreyudeals/* | sort -h

# 2. æ¸…ç†PM2æ—¥å¿—
pm2 flush

# 3. æ¸…ç†æ—§æ—¥å¿—
find ~/.pm2/logs -name "*.log" -mtime +7 -delete
find /www/wwwroot/Moreyudeals/packages/worker/logs -name "*.log" -mtime +7 -delete

# 4. æ¸…ç†ç³»ç»Ÿæ—¥å¿—
sudo journalctl --vacuum-time=7d

# 5. æ¸…ç†æ—§æ•°æ® (æ…ç”¨)
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "DELETE FROM deals WHERE created_at < NOW() - INTERVAL '60 days';"
```

---

## å®‰å…¨åŠ å›º

### 1. é˜²ç«å¢™é…ç½®

```bash
# å®‰è£…ufw
sudo apt install -y ufw

# å…è®¸SSH
sudo ufw allow 22/tcp

# ç¦æ­¢PostgreSQLå¤–éƒ¨è®¿é—®
sudo ufw deny 5432/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æ£€æŸ¥çŠ¶æ€
sudo ufw status verbose
```

### 2. PostgreSQLå®‰å…¨

```bash
# ç¼–è¾‘ postgresql.conf
sudo nano /etc/postgresql/15/main/postgresql.conf

# ç¡®ä¿åªç›‘å¬æœ¬åœ°
# listen_addresses = 'localhost'

# ç¼–è¾‘ pg_hba.conf
sudo nano /etc/postgresql/15/main/pg_hba.conf

# ç¡®ä¿åªå…è®¸æœ¬åœ°è¿æ¥
# local   all             all                                     peer
# host    all             all             127.0.0.1/32            md5

# é‡å¯PostgreSQL
sudo systemctl restart postgresql
```

### 3. SSHå®‰å…¨

```bash
# ç¼–è¾‘SSHé…ç½®
sudo nano /etc/ssh/sshd_config

# å»ºè®®ä¿®æ”¹:
# Port 2222                      # æ”¹ç«¯å£
# PermitRootLogin no             # ç¦æ­¢rootç™»å½•
# PasswordAuthentication no      # ç¦ç”¨å¯†ç ç™»å½•ï¼Œåªå…è®¸å¯†é’¥
# PubkeyAuthentication yes       # å¯ç”¨å…¬é’¥è®¤è¯

# é‡å¯SSH
sudo systemctl restart sshd
```

### 4. è‡ªåŠ¨å®‰å…¨æ›´æ–°

```bash
# å®‰è£…unattended-upgrades
sudo apt install -y unattended-upgrades

# å¯ç”¨è‡ªåŠ¨æ›´æ–°
sudo dpkg-reconfigure --priority=low unattended-upgrades
```

### 5. æ—¥å¿—å®¡è®¡

```bash
# æŸ¥çœ‹ç™»å½•å†å²
last -20

# æŸ¥çœ‹å¤±è´¥çš„ç™»å½•å°è¯•
sudo grep "Failed password" /var/log/auth.log | tail -20

# æŸ¥çœ‹sudoä½¿ç”¨è®°å½•
sudo grep "sudo" /var/log/auth.log | tail -20
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ä¿®æ”¹æŠ“å–é—´éš”?

**A**: ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `FETCH_INTERVAL`

```bash
# ç¼–è¾‘é…ç½®
nano /www/wwwroot/Moreyudeals/packages/worker/.env.production

# ä¿®æ”¹ä¸º60åˆ†é’Ÿ
FETCH_INTERVAL=60

# é‡å¯æœåŠ¡
pm2 restart moreyudeals-worker
```

### Q2: å¦‚ä½•ä¸´æ—¶å¯ç”¨ç¿»è¯‘æµ‹è¯•?

**A**: ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–

```bash
cd /www/wwwroot/Moreyudeals/packages/worker
TRANSLATION_ENABLED=true npx tsx src/index.ts
```

### Q3: æ•°æ®åº“å¯ä»¥ä»å¤–éƒ¨è®¿é—®å—?

**A**: å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé»˜è®¤åªå…è®¸æœ¬åœ°è®¿é—®ã€‚å¦‚éœ€å¤–éƒ¨è®¿é—®:

```bash
# 1. ä¿®æ”¹PostgreSQLé…ç½®
sudo nano /etc/postgresql/15/main/postgresql.conf
# ä¿®æ”¹: listen_addresses = '*'

# 2. ä¿®æ”¹pg_hba.conf
sudo nano /etc/postgresql/15/main/pg_hba.conf
# æ·»åŠ : host    moreyudeals    moreyudeals    YOUR_IP/32    md5

# 3. é‡å¯PostgreSQL
sudo systemctl restart postgresql

# 4. å¼€æ”¾é˜²ç«å¢™
sudo ufw allow from YOUR_IP to any port 5432
```

### Q4: å¦‚ä½•æŸ¥çœ‹å®æ—¶æŠ“å–è¿›åº¦?

**A**:

```bash
# æ–¹æ³•1: PM2æ—¥å¿—
pm2 logs moreyudeals-worker -f

# æ–¹æ³•2: Workeræ—¥å¿—æ–‡ä»¶
tail -f /www/wwwroot/Moreyudeals/packages/worker/logs/out.log

# æ–¹æ³•3: æ•°æ®åº“æŸ¥è¯¢
watch -n 10 "PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals -tAc 'SELECT COUNT(*) FROM deals;'"
```

### Q5: å¦‚ä½•æ¸…ç©ºæ‰€æœ‰æ•°æ®é‡æ–°å¼€å§‹?

**A**:

```bash
# 1. åœæ­¢æœåŠ¡
pm2 stop moreyudeals-worker

# 2. æ¸…ç©ºdealsè¡¨
PGPASSWORD=338e930fbb psql -h localhost -p 5432 -U moreyudeals -d moreyudeals \
  -c "TRUNCATE TABLE deals;"

# 3. é‡å¯æœåŠ¡
pm2 restart moreyudeals-worker
```

### Q6: æœåŠ¡å™¨é‡å¯åå¦‚ä½•æ¢å¤?

**A**: å¦‚æœå·²é…ç½®PM2å¼€æœºè‡ªå¯ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨æ¢å¤ã€‚å¦åˆ™:

```bash
# 1. å¯åŠ¨PostgreSQL
sudo systemctl start postgresql

# 2. å¯åŠ¨Worker
pm2 resurrect

# æˆ–æ‰‹åŠ¨å¯åŠ¨
cd /www/wwwroot/Moreyudeals/packages/worker
pm2 start ecosystem.config.js --env production
```

---

## é™„å½•

### ç›®å½•ç»“æ„

```
/www/wwwroot/Moreyudeals/
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ worker/
â”‚       â”œâ”€â”€ src/                 # æºä»£ç 
â”‚       â”œâ”€â”€ dist/                # ç¼–è¯‘åä»£ç 
â”‚       â”œâ”€â”€ migrations/          # æ•°æ®åº“è¿ç§»
â”‚       â”œâ”€â”€ logs/                # æ—¥å¿—ç›®å½•
â”‚       â”œâ”€â”€ .env.production      # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚       â”œâ”€â”€ ecosystem.config.js  # PM2é…ç½®
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy-server.sh         # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ init-database-server.sh  # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ update-server.sh         # æ›´æ–°è„šæœ¬
â””â”€â”€ README.md
```

### ç«¯å£ä½¿ç”¨

| ç«¯å£ | æœåŠ¡ | è®¿é—®èŒƒå›´ |
|------|------|---------|
| 22 | SSH | é™åˆ¶IP |
| 5432 | PostgreSQL | ä»…æœ¬åœ° |
| 80 | HTTP (å¯é€‰) | å…¬ç½‘ |
| 443 | HTTPS (å¯é€‰) | å…¬ç½‘ |

### æ€§èƒ½åŸºå‡† (åŸºäºT10éªŒè¯)

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å•æ¬¡æŠ“å–è€—æ—¶ | ~2.2ç§’ |
| APIè¯·æ±‚æ•° | 40æ¡/æ¬¡ |
| æ–°å¢è®°å½• | 6æ¡/æ¬¡ (å¹³å‡) |
| é‡å¤è®°å½• | 34æ¡/æ¬¡ (å¹³å‡) |
| æ ‡é¢˜ç¿»è¯‘è€—æ—¶ | ~250ms |
| HTMLç¿»è¯‘è€—æ—¶ | ~950ms |
| ç¿»è¯‘æˆåŠŸç‡ | 100% |
| å•†å®¶è¯†åˆ«ç‡ | 75% |
| å†…å­˜å ç”¨ | < 200MB |
| CPUå ç”¨ | < 5% (ç©ºé—²æ—¶) |

### è”ç³»ä¸æ”¯æŒ

- **æŠ€æœ¯æ”¯æŒ**: support@moreyu.com
- **GitHub**: https://github.com/PRYePR/moreyudeals
- **æ–‡æ¡£æ›´æ–°**: 2025-11-02

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼**
